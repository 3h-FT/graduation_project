<% set_meta_tags title: "ユーザーページ" %>

<div class="max-w-3xl mx-auto bg-yellow-50 p-6 rounded-lg shadow-lg">
  <div class="flex justify-center mb-4">
    <div class="flex items-center bg-yellow-100 text-yellow-700 text-md font-semibold px-4 py-2 rounded-full shadow-sm">
      <i class="bi bi-journals mr-2"></i> ためる
    </div>
  </div>

  <h2 class="text-center text-3xl font-semibold text-yellow-700 mb-2">
    <%= current_user.username %> さんのページ
  </h2>

  <div id="word-summary-header" class="text-center text-4xl font-semibold text-gray-700 mb-6">
    <%= render partial: 'userpages/header', locals: {
      total_count: @known_word_count,
      custom_count: @custom_words.count,
      favorite_count: @favorited_words.count
    } %>
  </div>

  <%= render 'search', q: @q, autocomplete_url: autocomplete_userpages_path %>
  
  <div class="w-full sm:w-3/4 mx-auto mb-6">
    <div class="flex items-center space-x-2">
      <h3 class="text-yellow-700 whitespace-nowrap text-md ">
        カテゴリー別:
      </h3>
      <div class="flex-grow">
        <%= form_with url: userpages_path, method: :get, local: true, class: "w-full" do %>
          <%= select_tag :filter,
              options_for_select(
                [["すべて", "all"], ["カスタム", "custom"], ["お気に入り", "favorite"]],
                selected: params[:filter] || "all"
              ),
              class: "w-full bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-yellow-300",
              onchange: "this.form.submit()" %>
          <button type="submit" class="hidden"></button>
        <% end %>
      </div>
    </div>
  </div>


  <% if params[:filter] == "custom" %>
    <div class="mt-6">
      <%= render 'new' %>
    </div>

    <div class="mt-6 bg-yellow-100 rounded-md p-4">
      <h3 class="text-center text-2xl font-semibold text-yellow-700 mt-2 mb-2">
        カスタムワード一覧
      </h3>
    
      <div id="custom_words">
        <%= render partial: "userpages/custom_words/word_section_with_pagination", locals: { words: @custom_words_page } %>
      </div>
    </div>

  <% elsif params[:filter] == "favorite" %>
    <div class="mt-6 bg-red-100 rounded-md p-4">
      <h3 class="text-center text-2xl font-semibold text-red-700 mt-2 mb-2">
        お気に入りのワード一覧
      </h3>
      <%= render 'favorited_words_section', words: @favorited_words_page %>
      <%= paginate @favorited_words_page, param_name: :favorited_page %>
    </div>

  <% else %> <%# all の場合 %>
    <div class="mt-6">
      <%= render 'new' %>
    </div>

    <div class="mt-6 bg-yellow-100 rounded-md p-4">
      <h3 class="text-center text-2xl font-semibold text-yellow-700 mt-2 mb-2">
        カスタムワード一覧
      </h3>
  
      <div id="custom_words">
        <%= render partial: "userpages/custom_words/word_section_with_pagination", locals: { words: @custom_words_page } %>
      </div>
    </div>

    <div class="mt-6 bg-red-100 rounded-md p-4">
      <h3 class="text-center text-2xl font-semibold text-red-700 mt-2 mb-2">
        お気に入りのワード一覧
      </h3>
      <%= render 'favorited_words_section', words: @favorited_words_page %>
      <%= paginate @favorited_words_page, param_name: :favorited_page %>
    </div>
  <% end %>
</div>
